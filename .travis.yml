branches:
  only:
    - master
    - dev
language: node_js
node_js:
- lts/*
git:
  depth: 15
install:
- yarn --frozen-lockfile
script:
  - yarn test
  - yarn generate
  # https://stackoverflow.com/questions/37544306/travis-different-script-for-different-branch
  - test "$TRAVIS_BRANCH" = "dev" && yarn build && ./lhci.sh || echo skip
  - test "$TRAVIS_BRANCH" = "master" &&  yarn zip || echo skip
addons:
  chrome: stable
cache: 
  - yarn
  - directories:
    - release/nuxt-element-dashboard/node_modules
    - release/nuxt-multiple-spa/node_modules
    - release/nuxt-vant/node_modules
deploy:
  #- provider: pages
  #  skip_cleanup: true
  #  github_token: $GITHUB_TOKEN  # Set in the settings page of your repository, as a secure variable
  #  local-dir: dist
  #  on:
  #    branch: master
  - provider: script
    skip_cleanup: true
    script: npx semantic-release
    on:
      branch: master
after_script:
  - ./notify.sh
